var se=Object.defineProperty;var ae=(r,e,t)=>e in r?se(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(ae(r,typeof e!="symbol"?e+"":e,t),t);var y=class{constructor(e){this.rootNode=e;a(this,"nodeCache",new Map);a(this,"observer");a(this,"pending",new Map)}get(e){let t=this.nodeCache.get(e);if(t)return t;let n=this.rootNode.querySelector(`#${e}`);if(n instanceof HTMLElement)return this.nodeCache.set(e,n),n}find(e){let t=this.get(e);return t?Promise.resolve(t):new Promise(n=>{this.pending.set(e,n),this.observer||this.init()})}resolve(e,t){this.nodeCache.set(e,t);let n=this.pending.get(e);n&&(n(t),this.pending.delete(e))}findPendingWithinNode(e){this.pending.forEach((t,n)=>{let i=e.querySelector(`#${n}`);i instanceof HTMLElement&&this.resolve(n,i)})}destroy(){this.observer?.disconnect(),delete this.observer,this.nodeCache.clear(),this.pending.forEach(e=>e()),this.pending.clear()}init(){this.observer=new MutationObserver(e=>{for(let t of e)t.addedNodes?.forEach(n=>{n instanceof HTMLElement&&(this.pending.has(n.id)?this.resolve(n.id,n):this.findPendingWithinNode(n))})}),this.observer.observe(this.rootNode,{childList:!0,subtree:!0})}};var k=r=>{switch(r){case"onClick":return"click";case"onMouseEnter":return"mouseenter";case"onMouseLeave":return"mouseleave";case"onMouseDown":return"mousedown";case"onMouseUp":return"mouseup";case"onDoubleClick":return"dblclick";case"onTouchStart":return"touchstart";case"onTouchEnd":return"touchend";case"onAnimationStart":return"animationstart";case"onAnimationEnd":return"animationend"}return""};function w(r,e,t){return`${r}.${e}${t?"|"+ge(t):""}`}function ge(r={}){return Object.keys(r).map(e=>`${e}:${r[e]}`).join("|")}function U(r={},{projectKey:e,pageKey:t}){let{event:n}=r;n&&window.dispatchEvent(new CustomEvent("vev.track",{detail:{type:n?.type,data:(n.data||[]).reduce((i,o)=>({...i,[o?.data?.key]:o?.data?.value}),{}),metaData:{projectKey:e,pageKey:t,timestamp:Date.now()}}}))}function T(r,e){let t=r.classList,n=t.contains("__hide"),i=r.clientWidth===0&&r.clientHeight===0;switch(e){case"SHOW":t.remove("__hide"),t.add("__show");return;case"HIDE":t.remove("__show"),t.add("__hide");return;case"TOGGLE_VISIBILITY":T(r,n||i?"SHOW":"HIDE");return;default:}}function B(r,e,t){let n=r?.classList;switch(e){case"STICK":n?.add("__sticky"),r.style.top=`${t}px`,r?.setAttribute("style",`top: ${t}px`);return;case"UNSTICK":n?.remove("__sticky"),r.style.removeProperty("top");return;default:}}var m=[],M;function p(...r){window.__vevInteractionDebug&&console.log(...r)}function N(r,...e){window.__vevInteractionDebug&&(m.push(e),M&&clearTimeout(M),M=self.setTimeout(()=>{if(m.length!==0){if(m.length===1)return console.log(...m[0]);console.groupCollapsed(r),m.forEach(t=>console.log(...t)),console.groupEnd(),m.length=0}},100))}var C=10,j=new Map,G=new Map,d;function $(r,e,t){let n=Math.floor(Math.max(r,C)/C),i=e?G:j,o=i.get(n);return o||(o=new Set,i.set(n,o),d||le()),o.add(t),()=>{o.delete(t),p(`\u{1F570}\uFE0F Removed callback from timeslot:${n} remaining in slot:${o.size}`),o.size===0&&i.delete(n),i.size===0&&Ee()}}function le(){p("\u23F0 Starting timer!");let r=1;d=self.setInterval(()=>{Y(r,G),Y(r,j),G.clear(),r++},C)}function Y(r,e){e.forEach((t,n)=>{if(r%n===0)for(let i of t)i()})}function Ee(){d&&(p("\u23F0 Stopping timer!"),clearInterval(d),d=void 0)}var ue={"":"EOF","!":"Not","=":"Equal",">":"Bigger","<":"Smaller",".":"ObjectAccessOperator",true:"True",false:"False"},A=class{constructor(){a(this,"input","");a(this,"pos",0)}isHyphen(e){return e==="-"}isNumber(e){return e>="0"&&e<="9"}processNumber(){let e=this.pos+1;for(;e<this.input.length&&this.isNumber(this.input[e]);)e++;let t={type:"Number",value:this.input.substring(this.pos,e)};return this.pos=e,t}isCharacter(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"||e==="-"}processIdentifierOrOperator(){let e=this.pos+1;for(;e<this.input.length&&this.isCharacter(this.input[e]);)e++;let t,n=this.input.substring(this.pos,e);return n==="AND"||n==="OR"?t={type:n==="AND"?"And":"Or",value:this.input.substring(this.pos,e)}:t={type:"Identifier",value:this.input.substring(this.pos,e)},this.pos=e,t}tokenize(e){this.input=e,this.pos=0;let t=[];for(;this.pos<this.input.length;){if(this.input[this.pos]===" "){this.pos++;continue}let n=ue[this.input[this.pos]];if(n)t.push({type:n,value:this.input[this.pos]}),this.pos++;else if(this.isNumber(this.input[this.pos])||this.isHyphen(this.input[this.pos])&&this.isNumber(this.input[this.pos+1]))t.push(this.processNumber());else if(this.isCharacter(this.input[this.pos]))t.push(this.processIdentifierOrOperator());else throw Error(`Unknown symbol ${this.input[this.pos]}`)}return t}};var f={Equal:(r,e)=>r===e,NotEqual:(r,e)=>r!==e,BiggerEqual:(r,e)=>r>=e,SmallerEqual:(r,e)=>r<=e,Bigger:(r,e)=>r>e,Smaller:(r,e)=>r<e},me={And:(r,e)=>r&&e,Or:(r,e)=>r||e},b=class{constructor(){}parse(e){return this.multiConditionExpression(e)}multiConditionExpression(e){let t=this.comparisonExpression(e);if(e[0]&&(e[0].type==="And"||e[0].type==="Or")){let n=e.shift()?.type;if(!n||!(n==="And"||n==="Or"))throw new Error("Parsing error: expected And/Or expression");let i=me[n],o=this.multiConditionExpression(e);return s=>i(t(s),o(s))}if(e[0]&&e[0].type!=="EOF")throw new Error(`Expected EOF got: ${JSON.stringify(e[0])}`);return t}comparisonExpression(e){let t=this.object(e),n=this.comparison(e),i=this.object(e);if(Array.isArray(t)&&!Array.isArray(i))return o=>n(this.getObjectValue(t,o),i);if(Array.isArray(t)&&Array.isArray(i))return o=>n(this.getObjectValue(t,o),this.getObjectValue(i,o));if(!Array.isArray(t)&&!Array.isArray(i))return()=>n(t,i);if(!Array.isArray(t)&&Array.isArray(i))return o=>n(t,this.getObjectValue(i,o));throw Error("Parsing error in comparisonExpression")}object(e){let t=[];if(e[0].type!=="Identifier"&&e[0].type!=="ObjectAccessOperator"||e[0].value==="false"||e[0].value==="true")return this.value(e);let n=e.shift()?.value;if(e[0]&&e[0].type==="ObjectAccessOperator"){e.shift();let i=this.object(e);if(Array.isArray(i))t.unshift(...i);else throw new Error(`Expected object identifier got ${i}`)}if(!n)throw new Error("Expected token value in object expression");return t.unshift(n),t}comparison(e){let t=e.shift()?.type;if(t==="Equal")return f.Equal;if(t==="Not"){if(e[0].type==="Equal")return e.shift(),f.NotEqual;throw Error(`Expected token Not got ${e[0].type}`)}if(t==="Bigger")return e[0].type==="Equal"?(e.shift(),f.BiggerEqual):f.Bigger;if(t==="Smaller")return e[0].type==="Equal"?(e.shift(),f.SmallerEqual):f.Smaller;throw new Error(`Expected comparison got: ${JSON.stringify(t)}`)}value(e){let t=e.shift();if(!t)throw new Error(`Expected value got: ${JSON.stringify(t)}`);if(t.type==="Number"){if(!t.value)throw new Error(`Expected value for token: ${JSON.stringify(t)}`);return parseInt(t.value)}if(t.type==="Identifier"){if(t.value==="true")return!0;if(t.value==="false")return!1;if(!t.value)throw new Error(`Expected value for token: ${JSON.stringify(t)}`);return t.value}if(t.type==="True")return!0;if(t.type==="False")return!1;throw new Error(`Expected value got: ${JSON.stringify(t)}`)}getObjectValue(e,t){for(let n of e)t&&(t=t[n]);return t===void 0?e[0]:t}};var bt=new A,St=new b;function c(r,e){p("\u{1F525} "+r,e),window.dispatchEvent(new CustomEvent("@@vev."+r,{detail:e}))}var P=(r,e)=>{let t=e==="onKeyDown"?"keydown":"keyup",n=i=>c(r,{type:i.type,args:{key:i.code}});return window.addEventListener(t,n),()=>window.removeEventListener(t,n)};var g=(r,e,t,n)=>{if(!n)return()=>{};let i=k(e),o=s=>c(r,{type:s.type,target:s.target});return n.addEventListener(i,o),()=>n.removeEventListener(i,o)};var W=r=>{let e=()=>{let t=Math.trunc((window.scrollY+window.innerHeight)/document.body.scrollHeight*100);c(r,{type:"onScroll",args:{scrollTop:window.scrollY,scrollHeight:document.body.scrollHeight,height:window.innerHeight,percentage:t}})};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)};var q=()=>(console.warn("TODO createSwipeTrigger \u{1FAE1}"),()=>{console.log("UNsubscribe swipe trigger")});var z=(r,e,t)=>{let n=t?.time||0,i=t?.once||!1;return $(n,i,()=>c(r,t))};var S=new Map;function fe(r){return r?`${r.offsetTop}-${r.offsetBottom}-${r.threshold||r.steps||0}`:"0"}function J(r,e,t){let n=fe(t);S.has(n)||S.set(n,{observer:new IntersectionObserver(l=>{l.forEach(u=>{let{target:v}=u,K=S.get(n)?.listeners.get(v);K&&K.forEach(oe=>oe(u))})},Te(t)),listeners:new Map});let{observer:i,listeners:o}=S.get(n);o.has(r)||(o.set(r,new Set),i.observe(r));let s=o.get(r);return s.add(e),()=>{s.delete(e),s.size||(o.delete(r),i.unobserve(r))}}var F=r=>typeof r=="number"?r*-1+"px":r?r.charAt(0)==="-"?r.substring(1):"-"+r:"0px";function Te(r){if(!r)return;typeof r=="number"&&(r={steps:r});let{offsetTop:e,offsetBottom:t,steps:n,threshold:i}=r,o={};if((e||t)&&(o.rootMargin=`${F(e)} 0px ${F(t)} 0px`,o.root=null),n){o.threshold=[];for(let s=0;s<=n;s++)o.threshold.push(s/n)}else i&&(o.threshold=i)}var V=(r,e,t,n)=>n?J(n,i=>{let o=i.isIntersecting?"onVisible":"onLeave";e===o&&c(r)}):()=>{};var X=(r,e,t,n)=>{let i=s=>c(r,s.detail),o=n||window;return o.addEventListener(e,i),()=>o.removeEventListener(e,i)};var Oe={onClick:g,onMouseEnter:g,onMouseLeave:g,onMouseDown:g,onMouseUp:g,onDoubleClick:g,onTouchStart:g,onTouchEnd:g,onAnimationStart:g,onAnimationEnd:g,onLeave:V,onVisible:V,onSwipe:q,onKeyDown:P,onKeyUp:P,onScroll:W,onTimer:z},I=new Map,O=new Map;function D(r,e,t,n){let i=t.map(([o,s])=>_e(r,e,o,s,n));return()=>i.forEach(o=>o())}function _e(r,e,t,n,i){let o=Oe[t]||X,s=`${r}.${w(e,t,n)}`;N("\u{1F477}\u200D\u2640\uFE0F Init triggers",`\u{1F52B} setting up trigger ${s}`),I.get(s)||I.set(s,o(s,t,n,i));let u=O.get(s)||0;return O.set(s,u+1),()=>{let v=O.get(s)||0;v===1?(I.get(s)?.(),I.delete(s),O.delete(s)):O.set(s,v-1)}}var Z=new Map;function Q(r,e,t){let n=e?.keyframes.map(u=>he(u,t)),i=ye(t,e?.type),o=r.id+JSON.stringify(t),s=Z.get(o);s&&s.cancel();let l=r.animate(n,i);return Z.set(o,l),()=>l.cancel()}function ve(r){switch(r){case"in":return"backwards";case"out":return"forwards";case"highlight":return}}var ye=(r,e)=>{let t=n=>({timeline:new window.ScrollTimeline({source:document.documentElement,axis:"block"}),rangeStart:`entry ${n["animation-range-start"]||0}%`,rangeEnd:`entry ${n["animation-range-end"]||100}%`});return{id:r.id,duration:+r?.duration*1e3||1e3,delay:+r?.delay*1e3||0,easing:r?.easing||"ease",fill:ve(e),iterations:r?.loop?1/0:1,direction:r?.alternate?"alternate":"normal",...r.scroll?t(r):{}}},he=(r,e)=>{let t=Object.keys(e||{}).filter(i=>i.startsWith("--")),n=JSON.stringify(r);for(;n.includes("var(");)for(let i of t)n=n.replace(new RegExp(`var\\(${i}\\)`,"g"),e[i]);return JSON.parse(n)};var ee=({args:r},e,{animations:t})=>{if(!r)return;let n=t?.[r.animation];n?Q(e,n,r):console.log(`Missing animation ${r?.animation}`),T(e,"SHOW")};var H=({type:r},e)=>{B(e,r)};var te=({type:r,args:e},t,{page:n,project:i})=>{U(e,{pageKey:n,projectKey:i})};var _=({type:r},e)=>{T(e,r)};var E=()=>{},Ne={SHOW:_,HIDE:_,TOGGLE_VISIBILITY:_,STICK:H,UNSTICK:H,SCROLL_TO_ELEMENT:E,OPEN_PAGE:E,OPEN_URL:E,DOWNLOAD_FILE:E,SEND_EMAIL:E,CALL_PHONE:E,SEND_SMS:E,SET_VARIABLE:_,TRACK:te,SHARE:E,ANIMATE:ee,CHANGE_VARIANT:void 0,TOGGLE_VARIANT:void 0};function re(r,e,t){let n=Ne[e.type];n?n(e,r,t):(p(`\u{1F578}\uFE0F Custom event:${e.type} \u{1F525} on node`,r),r.dispatchEvent(new CustomEvent(e.type,{detail:e.args})))}var Ae=typeof window<"u"&&window.__vevInitInteractionsNode,ne=new Map,ie=Ae||(r=>{window.__vevInteractionDebug=location.hostname==="qwiker-test.vev.design",p("\u2139\uFE0F Disable interaction debugging by setting window.__vevInteractionDebug = false");let e=ne.get(r.rootNode);e&&e.destroy(),e=new L(r),ne.set(r.rootNode,e),p("\u{1F680} Interaction scope initialized",e),window.__vevInteractionScopes||(window.__vevInteractionScopes=[]),window.__vevInteractionScopes.push(e)});typeof window<"u"&&(window.__vevInitInteractionsNode=ie);var x=class x{constructor(e){this.scope=e;a(this,"subscriptions",new Set);a(this,"scopeId",x.nextScopeId);a(this,"domScope");this.domScope=new y(e.rootNode),Object.entries(e.interactions.trigger).forEach(this.initTrigger.bind(this)),Object.entries(e.interactions.event).forEach(this.subscribe.bind(this))}destroy(){this.domScope.destroy(),this.subscriptions.forEach(e=>e())}async initTrigger([e,t]){if(e==="global")this.subscriptions.add(D(this.scopeId,e,t));else{let n=await this.domScope.find(e);n&&this.subscriptions.add(D(this.scopeId,e,t,n))}}subscribe([e,t]){let n=`@@vev.${this.scopeId}.${e}`,i=o=>{for(let s of t){let l=this.domScope.get(s.node);l&&re(l,s,this.scope)}};N("\u{1F3AF} Init target",`Adding listener ${e}`),window.addEventListener(n,i),this.subscriptions.add(()=>window.removeEventListener(n,i))}};a(x,"nextScopeId",1);var L=x;export{ie as initInteractionsNode};
